<!DOCTYPE html>
<html>
  <head>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
  </head>
  <body>
<div id="map"></div>

<style>
#map {
width: 800px;
height: 800px;
}
</style>
<script type="text/javascript">
d3.select(window).on('load', () => {
  const width = window.innerWidth * 0.8;
  const height = window.innerHeight * 0.8;

  const map = new L.Map("map", {center: [37.73135, -122.4299], zoom: 12})
    .addLayer(new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"));

  d3.json("sf_crime.geojson", json => {
    function projectPoint(x, y) {
      var point = map.latLngToLayerPoint(new L.LatLng(y, x));
      this.stream.point(point.x, point.y);
    }
    
    const projection = d3.geoTransform({point: projectPoint})

    const svg = d3.select(map.getPanes().overlayPane).append("svg")
      .attr("width", width)
      .attr("height", height)
    const g = svg.append("g").attr("class", "leaflet-zoom-hide");

    const path = d3.geoPath(projection)
    const feature = g.selectAll("path")
      .data(json.features)
      .enter()
      .append("path")

    feature.attr("d", path)

    // Reposition the SVG to cover the features.
    function reset() {
      var bounds = path.bounds(json),
        topLeft = bounds[0],
        bottomRight = bounds[1];

      svg.attr("width", bottomRight[0] - topLeft[0])
        .attr("height", bottomRight[1] - topLeft[1])
        .style("left", topLeft[0] + "px")
        .style("top", topLeft[1] + "px");

      g.attr("transform", "translate(" + -topLeft[0] + "," + -topLeft[1] + ")");

      feature.attr("d", path);
    }
    map.on("zoom", reset);
    reset();

  })
});
</script>
</body>
</html>
